<form [formGroup]="form" (ngSubmit)="onSubmit()" autocomplete="off">
  <!--First grid -->

  <div id="form1">
    <div class="row" style="padding: 0% 5% 0% 5%">
      <div class="ribbon-pop p-3 text-center fs-5" style="font-family: sans-serif">Booking Indent</div>
      <div class="col-md-12">
        <div class="card p-3">
          <div class="row g-3 align-items-end">
            <!-- Station From -->
            <div class="col-md-2 position-relative">
              <label for="ALOTsttnfrm" class="rainbow-label">
                <i class="bi bi-pin-map-fill text-primary me-1"></i>
                Station From
                <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control border border-light input-xs shadow-sm rounded-3 px-3 py-2"
                id="ALOTsttnfrm"
                formControlName="ALOTsttnfrm"
                name="ALOTsttnfrm"
                placeholder="Enter station code"
                [(ngModel)]="selectedStationCode"
                maxlength="4"
                (focus)="showStationDropdown = true"
                (input)="onStationFromInputChange($event)"
                (blur)="validateStationFromInput(); hideStationDropdownWithDelay(); onInputBlur('ALOTsttnfrm')"
                (keydown)="onHelpKeyDown($event, 'ALOTsttnfrm', filteredStationList, selectStationCode)"
                [ngClass]="formValidator.getValidationClass(form, 'ALOTsttnfrm')"
              />

              <!-- Station Code Dropdown -->
              <ul
                *ngIf="showStationDropdown && filteredStationList.length"
                class="dropdown-menu show shadow-sm border mt-1 rounded-3"
                style="
                  position: absolute;
                  top: 100%;
                  left: 0;
                  width: 100%;
                  z-index: 1000;
                  max-height: 220px;
                  overflow-y: auto;
                  transition: all 0.3s ease-in-out;
                  background-color: white;
                "
              >
                <!-- Grid Header -->
                <li class="dropdown-header bg-success px-3 py-2 text-black rounded-top">
                  <div class="d-grid" style="grid-template-columns: 50% 50%">
                    <div class="rainbow-label text-start">Code</div>
                    <div class="rainbow-label text-start">Name</div>
                  </div>
                </li>

                <!-- Grid Items -->
                <li
                  *ngFor="let station of filteredStationList; let i = index"
                  (mousedown)="selectStationCode(station)"
                  class="dropdown-item px-3 py-2"
                  [class.highlighted]="i === (highlightedIndices['ALOTsttnfrm'] ?? -1)"
                  style="cursor: pointer; border-bottom: 1px solid #eaeaea"
                >
                  <div class="d-grid align-items-center" style="grid-template-columns: 50% 50%; font-size: 0.75rem">
                    <div class="text-truncate text-start">{{ station.p_TrmnCode }}</div>
                    <div class="text-truncate text-start fw-medium">{{ station.p_TrmnName }}</div>
                  </div>
                </li>
              </ul>
            </div>

            <!-- Consignment ID -->
            <div class="col-md-2 position-relative">
              <label for="ALOTsttnto" class="form-label rainbow-label">
                <i class="bi bi-pin-map-fill text-primary me-1"></i>
                Station To
                <span class="text-danger">*</span>
              </label>

              <input
                type="text"
                class="form-control border border-light input-xs shadow-sm rounded-3 px-3 py-2"
                id="ALOTsttnto"
                name="ALOTsttnto"
                formControlName="ALOTsttnto"
                placeholder="Enter station code"
                [(ngModel)]="selectedStationToCode"
                maxlength="4"
                (focus)="showStationToDropdown = true"
                (input)="onStationToInputChange($event)"
                (blur)="validateStationToInput(); hideStationToDropdownWithDelay()"
                [ngClass]="formValidator.getValidationClass(form, 'ALOTsttnto')"
              />

              <!-- Station To Dropdown -->
              <ul
                *ngIf="showStationToDropdown && filteredStationToList.length"
                class="dropdown-menu show shadow-sm border mt-1 rounded-3"
                style="
                  position: absolute;
                  top: 100%;
                  left: 0;
                  width: 100%;
                  z-index: 1000;
                  max-height: 220px;
                  overflow-y: auto;
                  background-color: white;
                "
              >
                <!-- Grid Header -->
                <li class="dropdown-header bg-success text-black px-3 py-2 rounded-top">
                  <div class="d-grid" style="grid-template-columns: 50% 50%">
                    <div class="fw-bold text-start">Code</div>
                    <div class="fw-bold text-start">Name</div>
                  </div>
                </li>

                <!-- Grid Items -->
                <li
                  *ngFor="let station of filteredStationToList"
                  (mousedown)="selectStationToCode(station)"
                  class="dropdown-item px-3 py-2"
                  style="cursor: pointer; padding: 0.5rem 1rem; background: #fff; color: #0d1a26; border-bottom: 1px solid #f0f0f0"
                >
                  <div class="d-grid" style="grid-template-columns: 50% 50%; font-size: 0.75rem">
                    <div class="text-truncate text-start">{{ station.p_TrmnCode }}</div>
                    <div class="text-truncate text-start">{{ station.p_TrmnName }}</div>
                  </div>
                </li>
              </ul>

              <div
                *ngIf="form.errors?.sameStation && form.get('ALOTsttnto')?.touched"
                class="text-danger small"
                style="position: absolute; top: 100%; left: 0; z-index: 10; white-space: nowrap"
              >
                🚫 Station From and To cannot be the same.
              </div>
            </div>

            <!-- Current Date -->
            <div class="col-md-2">
              <label for="ALOTcurrDt" class="form-label rainbow-label">
                <i class="bi bi-pin-map-fill text-primary me-1"></i>
                Date
                <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                [min]="todayFormatted"
                class="form-control border border-light input-xs rounded-3 shadow-sm"
                formControlName="ALOTcurrDt"
                id="ALOTcurrDt"
                [value]=""
                name="ALOTcurrDt"
                [ngClass]="formValidator.getValidationClass(form, 'ALOTcurrDt')"
                (blur)="onInputChange('ALOTcurrDt')"
                (input)="onInputChange('ALOTcurrDt')"
              />
            </div>

            <!-- Service Mode -->
            <div class="col-md-2">
              <label for="ALOTsrvcMd" class="form-label rainbow-label">
                <i class="bi bi-pin-map-fill text-primary me-1"></i>
                Service
                <span class="text-danger">*</span>
              </label>

              <select
                class="form-select custom-select border border-light rounded-3 shadow-sm input-xs"
                formControlName="ALOTsrvcMd"
                id="ALOTsrvcMd"
                name="ALOTsrvcMd"
                [ngClass]="formValidator.getValidationClass(form, 'ALOTsrvcMd')"
                (blur)="onInputChange('ALOTsrvcMd')"
                (change)="onInputChange('ALOTsrvcMd')"
              >
                <option value="" disabled selected class="select-placeholder">Select service mode</option>
                <option value="TT">T T</option>
                <option value="TC">T C</option>
                <option value="TD">T D</option>
                <option value="CC">C C</option>
                <option value="CT">C T</option>
                <option value="CD">C D</option>
                <option value="DD">D D</option>
                <option value="DT">D T</option>
                <option value="DC">D C</option>
              </select>
            </div>

            <!-- Required Date -->
            <div class="col-md-2">
              <label for="ALOTreqdDt" class="form-label rainbow-label">
                <i class="bi bi-pin-map-fill text-primary me-1"></i>
                Required Date
                <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                class="form-control border border-light input-xs rounded-3 shadow-sm"
                [min]="todayFormatted"
                formControlName="ALOTreqdDt"
                id="ALOTreqdDt"
                name="ALOTreqdDt"
                [ngClass]="form.get('ALOTreqdDt')?.enabled ? formValidator.getValidationClass(form, 'ALOTreqdDt') : ''"
                (blur)="onInputChange('ALOTreqdDt')"
                (input)="onInputChange('ALOTreqdDt')"
              />
            </div>

            <!-- Delivery Date -->
            <div class="col-md-2">
              <label for="ALOTdlvrDt" class="form-label rainbow-label">
                <i class="bi bi-pin-map-fill text-primary me-1"></i>
                Deliver Date
                <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                class="form-control border border-light input-xs rounded-3 shadow-sm"
                [min]="tomorrowFormatted"
                formControlName="ALOTdlvrDt"
                id="ALOTdlvrDt"
                name="ALOTdlvrDt"
                [ngClass]="form.get('ALOTdlvrDt')?.enabled ? formValidator.getValidationClass(form, 'ALOTdlvrDt') : ''"
                (blur)="onInputChange('ALOTdlvrDt')"
                (input)="onInputChange('ALOTdlvrDt')"
              />
            </div>
          </div>

          <div class="row g-3 align-items-end p-1">
            <!-- Toggle Section -->
            <div class="col-md-4">
              <fieldset class="border rounded-4 shadow-sm bg-light px-3 pt-1 pb-3">
                <legend class="float-none w-auto px-3 text-primary-emphasis fs-6 fw-bold">
                  <label for="ALOTPaidby" class="fw-semibold" style="color: #464444">
                    <i class="bi bi-sliders2 me-1"></i>
                    Options
                    <span class="text-danger">*</span>
                  </label>
                </legend>

                <div class="d-flex justify-content-center align-items-center">
                  <div class="d-flex flex-wrap justify-content-center align-items-center gap-4">
                    <!-- Grow Tick -->
                    <label class="modern-round-checkbox">
                      <input type="checkbox" id="ALOTrebooking" formControlName="ALOTrebooking" name="ALOTrebooking" />
                      <span class="round-check"></span>
                      <i class="bi bi-tree-fill text-success me-1"></i>
                      Rebooking
                    </label>

                    <!-- Rake -->
                    <!-- <label class="modern-round-checkbox">
          <input type="checkbox" id="ALOTrake" formControlName="ALOTrake" name="ALOTrake">
          <span class="round-check"></span>
          <i class="bi bi-train-front text-success me-1"></i> Rake
        </label> -->

                    <!-- Owned -->
                    <label class="modern-round-checkbox">
                      <input type="checkbox" id="ALOTowned" [(ngModel)]="isOwnedChecked" name="ALOTowned" formControlName="ALOTowned" />
                      <span class="round-check"></span>
                      Owned
                    </label>
                  </div>
                </div>
              </fieldset>
            </div>

            <!-- Input Fields Section -->
            <div class="col-md-8">
              <div class="row g-3 align-items-end">
                <!-- Rate Type -->
                <!-- <div class="col-md-3">
                  <label for="ALOTrateType" class="form-label rainbow-label ">
                    <i class="bi bi-pin-map-fill text-primsttnary me-1"></i>Rate Type <span class="text-danger">*</span>
                  </label>

                  <select 
                    class="form-select custom-select border border-light rounded-3 input-xs shadow-sm" 
                    formControlName="ALOTrateType" 
                    id="ALOTrateType" 
                    name="ALOTrateType"
                    [ngClass]="formValidator.getValidationClass(form, 'ALOTrateType')">
                    
                    <option value="N">Normal</option>
                    <option value="S">Special</option>
                    <option value="I">ISO</option>
                    <option value="C">Composite</option>
                    <option value="D">Customer</option>
                  </select>
                </div> -->

                <!-- Payment Type -->
                <div class="col-md-3">
                  <label for="ALOTpymntTyp" class="form-label rainbow-label">
                    <i class="bi bi-pin-map-fill text-primary me-1"></i>
                    Payment Type
                    <span class="text-danger">*</span>
                  </label>

                  <select
                    class="form-select border border-light shadow-sm rounded-3 px-3 py-2 input-xs"
                    id="ALOTpymntTyp"
                    name="ALOTpymntTyp"
                    formControlName="ALOTpymntTyp"
                    (blur)="onInputChange('ALOTpymntTyp')"
                    (change)="onInputChange('ALOTpymntTyp')"
                    [ngClass]="formValidator.getValidationClass(form, 'ALOTpymntTyp')"
                  >
                    <option value="" disabled selected>Select Payment Type</option>
                    <option value="P">P</option>
                    <option value="T">T</option>
                  </select>
                </div>

                <!-- Commodity Code -->
                <div class="col-md-9 position-relative">
                  <!-- Wider container for both inputs -->
                  <div class="row">
                    <!-- Commodity Code Input -->
                    <div class="col-md-6">
                      <label for="ALOTcmdtCode" class="form-label rainbow-label">
                        <i class="bi bi-pin-map-fill text-primary me-1"></i>
                        Commodity Code
                        <span class="text-danger">*</span>
                      </label>
                      <input
                        type="text"
                        class="form-control border border-light input-xs shadow-sm rounded-3 px-3 py-2"
                        id="ALOTcmdtCode"
                        formControlName="ALOTcmdtCode"
                        name="ALOTcmdtCode"
                        placeholder="Enter code"
                        readonly
                        [(ngModel)]="selectedCmdtCode"
                        (focus)="showDropdown = true"
                        (blur)="hideDropdownWithDelay()"
                        (input)="filterCmdtList(selectedCmdtCode)"
                        (blur)="onInputChange('ALOTcmdtCode')"
                        (input)="onInputChange('ALOTcmdtCode')"
                        [ngClass]="formValidator.getValidationClass(form, 'ALOTcmdtCode')"
                      />
                    </div>

                    <!-- CMDT Description Input -->
                    <div class="col-md-6">
                      <label for="ALOTcmdtDesc" class="form-label rainbow-label">
                        <i class="bi bi-pin-map-fill text-primary me-1"></i>
                        Description
                      </label>
                      <input
                        type="text"
                        class="form-control border border-light input-xs shadow-sm rounded-3 px-3 py-2"
                        id="ALOTcmdtDesc"
                        formControlName="ALOTcmdtDesc"
                        name="ALOTcmdtDesc"
                        readonly
                        (blur)="onInputChange('ALOTcmdtDesc')"
                        [value]="selectedCmdtDesc"
                        readonly
                        placeholder="CMDT Description"
                        [ngClass]="formValidator.getValidationClass(form, 'ALOTcmdtDesc')"
                      />
                    </div>
                  </div>

                  <!-- Dropdown positioned below both inputs -->
                  <ul
                    *ngIf="showDropdown && filteredCmdtList.length"
                    class="dropdown-menu show shadow-sm border mt-1 rounded-3"
                    style="position: absolute; top: 100%; left: 0; width: 100%; z-index: 1000; max-height: 220px; overflow-y: auto"
                  >
                    <li class="dropdown-header bg-success text-black small px-3 py-2 rounded-top">
                      <div class="d-flex justify-content-between small fw-bold">
                        <span style="width: 25%">Code</span>
                        <span style="width: 55%">Description</span>
                        <span style="width: 10%">Hazard</span>
                      </div>
                    </li>
                    <li
                      *ngFor="let item of filteredCmdtList"
                      class="dropdown-item small px-3 py-2"
                      style="cursor: pointer"
                      (mousedown)="selectCmdtCode(item)"
                    >
                      <div class="d-flex justify-content-between" style="font-size: 0.75rem">
                        <span style="width: 25%">{{ item.p_CmdtCode }}</span>
                        <span style="width: 35%">{{ item.p_CmdtDesc }}</span>
                        <span style="width: 15%">{{ item.p_HzdsFlag }}</span>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <!-- Middle column: content -->
            <div class="col-md-12">
              <!-- Consigner Section (displayed when showConsigner is true) -->
              <div class="row">
                <div class="col-md-6">
                  <fieldset class="border rounded-4 shadow-sm bg-light px-3 py-2">
                    <legend class="float-none w-auto px-3 text-primary-emphasis fs-5 fw-bold">
                      <label for="ALOTPaidby" class="fw-semibold" style="color: #464444; font-size: medium">
                        <i class="bi bi-sliders2 me-1"></i>
                        Consigner
                        <span class="text-danger">*</span>
                      </label>
                    </legend>

                    <!-- Row 1: Code / Name / ID -->
                    <div class="row g-2">
                      <!-- Consigner Code with Dropdown -->
                      <div class="col-md-6 position-relative">
                        <label for="ALOTcnsrCode" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Code
                          <span class="text-danger">*</span>
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          id="ALOTcnsrCode"
                          formControlName="ALOTcnsrCode"
                          name="ALOTcnsrCode"
                          [(ngModel)]="selectedCnsrCode"
                          (input)="filterConsignerList(selectedCnsrCode)"
                          (focus)="showConsignerDropdown = true"
                          (blur)="hideConsignerDropdownWithDelay()"
                          (blur)="onInputChange('ALOTcnsrCode')"
                          (input)="onInputChange('ALOTcnsrCode')"
                          placeholder="Enter Code"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsrCode')"
                          maxlength="4"
                          minlength="3"
                        />

                        <!-- Custom Dropdown -->
                        <ul
                          *ngIf="showConsignerDropdown && filteredConsignerList.length"
                          class="dropdown-menu show shadow-sm border mt-1 rounded-3"
                          style="position: absolute; top: 100%; left: 0; width: 100%; z-index: 1000; max-height: 220px; overflow-y: auto"
                        >
                          <li class="dropdown-header bg-success text-black small px-3 py-2 rounded-top">
                            <div class="d-flex justify-content-between small fw-bold">
                              <span class="w-50 text-start">Code</span>
                              <span class="w-50 text-center">Name</span>
                            </div>
                          </li>
                          <li
                            *ngFor="let item of filteredConsignerList"
                            class="dropdown-item small px-3 py-2"
                            style="cursor: pointer"
                            (mousedown)="selectConsigner(item)"
                          >
                            <div class="d-flex justify-content-between">
                              <span class="w-50 text-start">{{ item.p_CustCode }}</span>
                              <span class="w-50 text-center">{{ item.p_CustName }}</span>
                            </div>
                          </li>
                        </ul>
                      </div>

                      <!-- Consigner Name -->

                      <div class="col-md-6">
                        <label for="ALOTcnsrName" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Name
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          readonly
                          formControlName="ALOTcnsrName"
                          id="ALOTcnsrName"
                          name="ALOTcnsrName"
                          placeholder="Name"
                          [value]="selectedCnsrName"
                          (blur)="onInputChange('ALOTcnsrName')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsrName')"
                        />
                      </div>

                      <!-- Consigner ID -->
                      <!-- <div class="col-md-4 position-relative">
  <label for="ALOTcnsrId" class="form-label rainbow-label " style="color: #383a3a;">
    <i class="bi bi-pin-map-fill text-primary me-1"></i>
    ID <span class="text-danger">*</span>
  </label>

  <input
    type="text"
    class="form-control border border-light input-xs rounded-3 shadow-sm"
    id="ALOTcnsrId"
    name="ALOTcnsrId"
    formControlName="ALOTcnsrId"
    placeholder="ID"
    readonly
    [(ngModel)]="selectedConsignerId"
    (input)="filterConsignerIdFromEvent($event)" 
    (focus)="showConsignerIDDropdown = true"
    (blur)="hideConsignerIDDropdownWithDelay()"
    (focusin)="clearConsignerIDDropdownTimeout()"
    [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsrId')"
  />
  
  <ul *ngIf="showConsignerIDDropdown && filteredConsignerIdList.length"
      class="dropdown-menu show shadow-sm border mt-1 rounded-3 w-100"
      style="position: absolute; z-index: 1000; max-height: 220px; overflow-y: auto;">
    
    
    <li class="dropdown-header px-3 py-2 bg-success text-black d-flex justify-content-between rainbow-label  small rounded-top">
      <span> Cust ID</span>
    </li>

    
      <li
          *ngFor="let item of filteredConsignerIdList"
          class="dropdown-item small px-3 py-2"
          style="cursor: pointer;"
          (mousedown)="selectConsignerID(item)"
          
        >
          <div class="d-flex justify-content-between" style="font-size: 0.75rem;">
            <span class="w-50 text-start">{{ item.p_CustID }}</span>
          </div>
        </li>
  </ul>
</div> -->
                    </div>

                    <!-- Row 2: Address, City, State -->
                    <div class="row g-2 mt-1">
                      <!-- Address -->
                      <!-- <div class="col-md-6">
                          
                          <label for="ALOTcnsrAdrs" class="form-label rainbow-label " style="color: #383a3a;"><i class="bi bi-pin-map-fill text-primary me-1"></i>Address </label>
                          <input type="text" class="form-control border border-light input-xs  rounded-3 shadow-sm " readonly formControlName="ALOTcnsrAdrs" id="ALOTcnsrAdrs" name="ALOTcnsrAdrs" placeholder="Address" [value]="selectedCnsrAddress" (blur)="onInputChange('ALOTcnsrAdrs')"  [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsrAdrs')"  >
                        </div> -->

                      <div class="col-md-6 position-relative">
                        <label for="ALOTcnsrId" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Address
                          <span class="text-danger">*</span>
                        </label>

                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          id="ALOTcnsrId"
                          name="ALOTcnsrId"
                          formControlName="ALOTcnsrId"
                          placeholder="Address"
                          readonly
                          [(ngModel)]="selectedCnsrAddress"
                          (input)="filterConsignerIdFromEvent($event)"
                          (focus)="showConsignerIDDropdown = true"
                          (blur)="hideConsignerIDDropdownWithDelay()"
                          (focusin)="clearConsignerIDDropdownTimeout()"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsrId')"
                        />

                        <ul
                          *ngIf="showConsignerIDDropdown && filteredConsignerIdList.length"
                          class="dropdown-menu show shadow-sm border mt-1 rounded-3 w-100"
                          style="position: absolute; z-index: 1000; max-height: 220px; overflow-y: auto"
                        >
                          <li
                            class="dropdown-header px-3 py-2 bg-success text-black d-flex justify-content-between rainbow-label small rounded-top"
                          >
                            <span>Cust ID</span>
                          </li>

                          <li
                            *ngFor="let item of filteredConsignerIdList"
                            class="dropdown-item small px-3 py-2"
                            style="cursor: pointer"
                            (mousedown)="selectConsignerID(item)"
                          >
                            <div class="d-flex justify-content-between" style="font-size: 0.75rem">
                              <span class="w-50 text-start">{{ item.p_CustID }}</span>
                            </div>
                          </li>
                        </ul>
                      </div>

                      <!-- City -->
                      <div class="col-md-3">
                        <label for="ALOTcnsrcity" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          City
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          readonly
                          formControlName="ALOTcnsrcity"
                          id="ALOTcnsrcity"
                          name="ALOTcnsrcity"
                          placeholder="City"
                          [value]="selectedCnsrCity"
                          (blur)="onInputChange('ALOTcnsrcity')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsrcity')"
                        />
                      </div>

                      <!-- State -->
                      <div class="col-md-3">
                        <label for="ALOTcnsrstat" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          State
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          readonly
                          formControlName="ALOTcnsrstat"
                          id="ALOTcnsrstat"
                          name="ALOTcnsrstat"
                          placeholder="State"
                          [value]="selectedCnsrState"
                          (blur)="onInputChange('ALOTcnsrstat')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsrstat')"
                        />
                      </div>
                    </div>

                    <!-- Row 3: Phone, Email -->
                    <div class="row g-2 mt-1">
                      <!-- Phone -->

                      <div class="col-md-6">
                        <label for="ALOTcnsrPhon" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Phone
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          readonly
                          formControlName="ALOTcnsrPhon"
                          id="ALOTcnsrPhon"
                          name="ALOTcnsrPhon"
                          placeholder="Phone no"
                          [value]="selectedCnsrPhone"
                          (blur)="onInputChange('ALOTcnsrPhon')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsrPhon')"
                        />
                      </div>

                      <!-- Email -->

                      <div class="col-md-6">
                        <label for="ALOTcnsremail" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Email
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          readonly
                          formControlName="ALOTcnsremail"
                          id="ALOTcnsremail"
                          name="ALOTcnsremail"
                          placeholder="Email"
                          [value]="selectedCnsrEmail"
                          (blur)="onInputChange('ALOTcnsremail')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsremail')"
                        />
                      </div>
                    </div>

                    <!-- Row 4: GSTN, Distance, Pick-Up Point -->
                    <div class="row g-2 mt-1">
                      <!-- GSTN -->

                      <div class="col-md-4">
                        <label for="ALOTcnsrGstno" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Gstn no.
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          readonly
                          formControlName="ALOTcnsrGstno"
                          id="ALOTcnsrGstno"
                          name="ALOTcnsrGstno"
                          placeholder="Enter Gstn no."
                          [value]="selectedCnsrGSTN"
                          (blur)="onInputChange('ALOTcnsrGstno')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsrGstno')"
                        />
                      </div>
                      <!-- Pick-Up Point -->

                      <div class="col-md-4 position-relative">
                        <label for="ALOTcnsrPikup" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Pick-up Point
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          (focus)="showConsignerpickupDropdown = true"
                          (focusin)="clearConsignerpickupDropdownTimeout()"
                          [(ngModel)]="selectedConsignerPick"
                          formControlName="ALOTcnsrPikup"
                          id="ALOTcnsrPikup"
                          name="ALOTcnsrPikup"
                          placeholder="Pick-Up Point"
                          (blur)="onInputChange('ALOTcnsrPikup'); hideConsignerpickupDropdownWithDelay()"
                          (input)="
                            onInputChange('ALOTcnsrPikup'); filterConsignerPickupFromEvent($event); Datevalidation.onAlphaOnly($event)
                          "
                          [ngClass]="form.get('ALOTcnsrPikup')?.enabled ? formValidator.getValidationClass(form, 'ALOTcnsrPikup') : ''"
                        />

                        <ul
                          *ngIf="showConsignerpickupDropdown && filteredConsignerPickList.length"
                          class="dropdown-menu show shadow-sm border mt-1 rounded-3 w-100"
                          style="position: absolute; z-index: 1000; max-height: 220px; overflow-y: auto"
                        >
                          <!-- Header -->
                          <li
                            class="dropdown-header px-3 py-2 bg-success text-black d-flex justify-content-between rainbow-label small rounded-top"
                          >
                            <span class="w-90 text-start">Pickup</span>
                            <span class="w-10 text-end">Distance</span>
                          </li>

                          <!-- Filtered Options -->
                          <li
                            *ngFor="let item of filteredConsignerPickList"
                            class="dropdown-item small px-3 py-2"
                            style="cursor: pointer"
                            (mousedown)="selectConsignerpickup(item)"
                          >
                            <div class="d-flex justify-content-between" style="font-size: 0.75rem">
                              <span class="w-90 text-start">{{ item.p_PickDlvrName }}</span>
                              <span class="w-10 text-end">{{ item.p_PickDlvrDist }}</span>
                            </div>
                          </li>
                        </ul>
                      </div>

                      <!-- Distance -->

                      <div class="col-md-4">
                        <label for="ALOTcnsrDist" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Distance
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          formControlName="ALOTcnsrDist"
                          (input)="Datevalidation.onNumericOnly($event)"
                          id="ALOTcnsrDist"
                          name="ALOTcnsrDist"
                          placeholder="Distance"
                          (blur)="onInputChange('ALOTcnsrDist')"
                          (input)="onInputChange('ALOTcnsrDist')"
                          [ngClass]="form.get('ALOTcnsrDist')?.enabled ? formValidator.getValidationClass(form, 'ALOTcnsrDist') : ''"
                        />
                      </div>
                    </div>
                  </fieldset>
                </div>

                <!-- Consignee Section (displayed when showConsignee is false) -->
                <div class="col-md-6">
                  <fieldset class="border rounded-4 shadow-sm bg-light px-3 py-2">
                    <legend class="float-none w-auto px-3 text-primary-emphasis fs-5 fw-bold">
                      <label for="ALOTPaidby" class="fw-semibold" style="color: #464444; font-size: medium">
                        <i class="bi bi-sliders2 me-1"></i>
                        Consignee
                        <span class="text-danger">*</span>
                      </label>
                    </legend>

                    <!-- Row 1: Code / Name / ID -->
                    <div class="row g-2">
                      <!-- Consigner Code with Dropdown -->
                      <div class="col-md-6 position-relative">
                        <label for="ALOTcnseCode" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Code
                          <span class="text-danger">*</span>
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          id="ALOTcnseCode"
                          formControlName="ALOTcnseCode"
                          name="ALOTcnseCode"
                          readonly
                          [(ngModel)]="selectedCgneCode"
                          (input)="filterConsigneeList(selectedCgneCode)"
                          (focus)="showConsigneeDropdown = true"
                          (blur)="hideConsigneeDropdownWithDelay()"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnseCode')"
                          (blur)="onInputChange('ALOTcnseCode')"
                          (input)="onInputChange('ALOTcnseCode')"
                          placeholder="Enter Code"
                        />

                        <!-- Custom Dropdown -->
                        <ul
                          *ngIf="showConsigneeDropdown && filteredConsigneeList.length"
                          class="dropdown-menu show shadow-sm border mt-1 rounded-3"
                          style="position: absolute; top: 100%; left: 0; width: 100%; z-index: 1000; max-height: 220px; overflow-y: auto"
                        >
                          <li class="dropdown-header bg-success text-black small px-3 py-2 rounded-top">
                            <div class="d-flex justify-content-between small fw-bold">
                              <span class="w-50 text-start">Code</span>
                              <span class="w-50 text-center">Name</span>
                            </div>
                          </li>
                          <li
                            *ngFor="let item of filteredConsigneeList"
                            class="dropdown-item small px-3 py-2"
                            style="cursor: pointer"
                            (mousedown)="selectConsignee(item)"
                          >
                            <div class="d-flex justify-content-between" style="font-size: 0.75rem">
                              <span class="w-50 text-start">{{ item.p_CustCode }}</span>
                              <span class="w-50 text-center">{{ item.p_CustName }}</span>
                            </div>
                          </li>
                        </ul>
                      </div>

                      <!-- Consigner Name -->

                      <div class="col-md-6">
                        <label for="ALOTcnseName" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Name
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          readonly
                          formControlName="ALOTcnseName"
                          id="ALOTcnseName"
                          name="ALOTcnseName"
                          placeholder="Address"
                          [value]="selectedCgneName"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnseName')"
                          (blur)="onInputChange('ALOTcnseName')"
                          readonly
                        />
                      </div>

                      <!-- Consigner ID -->

                      <!-- <div class="col-md-4 position-relative">
                        <label for="ALOTcnsId" class="form-label rainbow-label " style="color: #383a3a;">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          ID <span class="text-danger">*</span>
                        </label>

                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          id="ALOTcnseId"
                          name="ALOTcnseId"
                          readonly
                          formControlName="ALOTcnseId"
                          placeholder="ID"
                          [(ngModel)]="selectedConsigneeId"
                          (input)="filterConsigneeIdFromEvent($event)"
                          (focus)="showConsigneeIDDropdown = true"
                          (blur)="hideConsigneeIDDropdownWithDelay()"
                          (focusin)="clearConsigneeIDDropdownTimeout()"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnseId')"
                        />
                       
                        <ul *ngIf="showConsigneeIDDropdown && filteredConsigneeIdList.length"
                            class="dropdown-menu show shadow-sm border mt-1 rounded-3 w-100"
                            style="position: absolute; z-index: 1000; max-height: 220px; overflow-y: auto;">
                          
                          
                          <li class="dropdown-header px-3 py-2 bg-success text-black d-flex justify-content-between rainbow-label  small rounded-top">
                            <span> Cust ID</span>
                          </li>

                          
                         

                          <li *ngFor="let item of filteredConsigneeIdList"
                            class="dropdown-item small px-3 py-2"
                            style="cursor: pointer;"
                            (mousedown)="selectConsigneeID(item)">
                            <div class="d-flex justify-content-between"  style="font-size: 0.75rem;">
                              <span class="w-50 text-start">{{ item.p_CustID }}</span>
                            </div>
                          </li>
                        </ul>
                      </div> -->
                    </div>

                    <!-- Row 2: Address, City, State -->
                    <div class="row g-2 mt-1">
                      <!-- Address -->
                      <!-- <div class="col-md-6">
                          
                          <label for="ALOTcnseAdrs" class="form-label rainbow-label " style="color: #383a3a;"><i class="bi bi-pin-map-fill text-primary me-1"></i>Address </label>
                          <input type="text" class="form-control border border-light input-xs  rounded-3 shadow-sm "  formControlName="ALOTcnseAdrs" id="ALOTcnseAdrs" name="ALOTcnseAdrs" placeholder="Address" [value]="selectedCgneAddress" (blur)="onInputChange('ALOTcnseAdrs')"  [ngClass]="formValidator.getValidationClass(form, 'ALOTcnseAdrs')" readonly>
                        </div> -->

                      <div class="col-md-6 position-relative">
                        <label for="ALOTcnsId" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Address
                          <span class="text-danger">*</span>
                        </label>

                        <!-- <div class="col-md-4 position-relative">
                        <label for="ALOTcnsId" class="form-label rainbow-label " style="color: #383a3a;">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          ID <span class="text-danger">*</span>
                        </label>

                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          id="ALOTcnseId"
                          name="ALOTcnseId"
                          readonly
                          formControlName="ALOTcnseId"
                          placeholder="ID"
                          [(ngModel)]="selectedConsigneeId"
                          (input)="filterConsigneeIdFromEvent($event)"
                          (focus)="showConsigneeIDDropdown = true"
                          (blur)="hideConsigneeIDDropdownWithDelay()"
                          (focusin)="clearConsigneeIDDropdownTimeout()"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnseId')"
                        />
                       
                        <ul *ngIf="showConsigneeIDDropdown && filteredConsigneeIdList.length"
                            class="dropdown-menu show shadow-sm border mt-1 rounded-3 w-100"
                            style="position: absolute; z-index: 1000; max-height: 220px; overflow-y: auto;">
                          
                          
                          <li class="dropdown-header px-3 py-2 bg-success text-black d-flex justify-content-between rainbow-label  small rounded-top">
                            <span> Cust ID</span>
                          </li>

                          
                         

                          <li *ngFor="let item of filteredConsigneeIdList"
                            class="dropdown-item small px-3 py-2"
                            style="cursor: pointer;"
                            (mousedown)="selectConsigneeID(item)">
                            <div class="d-flex justify-content-between"  style="font-size: 0.75rem;">
                              <span class="w-50 text-start">{{ item.p_CustID }}</span>
                            </div>
                          </li>
                        </ul>
                      </div> -->

                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          id="ALOTcnseId"
                          name="ALOTcnseId"
                          readonly
                          formControlName="ALOTcnseId"
                          placeholder="Address"
                          [(ngModel)]="selectedCgneAddress"
                          (input)="filterConsigneeIdFromEvent($event)"
                          (focus)="showConsigneeIDDropdown = true"
                          (blur)="hideConsigneeIDDropdownWithDelay()"
                          (focusin)="clearConsigneeIDDropdownTimeout()"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnseId')"
                        />

                        <ul
                          *ngIf="showConsigneeIDDropdown && filteredConsigneeIdList.length"
                          class="dropdown-menu show shadow-sm border mt-1 rounded-3 w-100"
                          style="position: absolute; z-index: 1000; max-height: 220px; overflow-y: auto"
                        >
                          <li
                            class="dropdown-header px-3 py-2 bg-success text-black d-flex justify-content-between rainbow-label small rounded-top"
                          >
                            <span>Cust ID</span>
                          </li>

                          <li
                            *ngFor="let item of filteredConsigneeIdList"
                            class="dropdown-item small px-3 py-2"
                            style="cursor: pointer"
                            (mousedown)="selectConsigneeID(item)"
                          >
                            <div class="d-flex justify-content-between" style="font-size: 0.75rem">
                              <span class="w-50 text-start">{{ item.p_CustID }}</span>
                            </div>
                          </li>
                        </ul>
                      </div>

                      <!-- City -->
                      <div class="col-md-3">
                        <label for="ALOTcnsecity" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          City
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          formControlName="ALOTcnsecity"
                          id="ALOTcnsecity"
                          name="ALOTcnsecity"
                          placeholder="City"
                          [value]="selectedCgneCity"
                          (blur)="onInputChange('ALOTcnsecity')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsecity')"
                          readonly
                        />
                      </div>

                      <!-- State -->
                      <div class="col-md-3">
                        <label for="ALOTcnsestat" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          State
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          formControlName="ALOTcnsestat"
                          id="ALOTcnsestat"
                          name="ALOTcnsestat"
                          placeholder="State"
                          [value]="selectedCgneState"
                          (blur)="onInputChange('ALOTcnsestat')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsestat')"
                          readonly
                        />
                      </div>
                    </div>

                    <!-- Row 3: Phone, Email -->
                    <div class="row g-2 mt-1">
                      <!-- Phone -->

                      <div class="col-md-6">
                        <label for="ALOTcnsePhon" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Phone
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          formControlName="ALOTcnsePhon"
                          id="ALOTcnsePhon"
                          name="ALOTcnsePhon"
                          placeholder="Phone no"
                          [value]="selectedCgnePhone"
                          (blur)="onInputChange('ALOTcnsePhon')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnsePhon')"
                          readonly
                        />
                      </div>

                      <!-- Email -->

                      <div class="col-md-6">
                        <label for="ALOTcnseemail" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Email
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          formControlName="ALOTcnseemail"
                          id="ALOTcnseemail"
                          name="ALOTcnseemail"
                          placeholder="Email"
                          [value]="selectedCgneEmail"
                          (blur)="onInputChange('ALOTcnseemail')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnseemail')"
                          readonly
                        />
                      </div>
                    </div>

                    <!-- Row 4: GSTN, Distance, Pick-Up Point -->
                    <div class="row g-2 mt-1">
                      <!-- GSTN -->

                      <div class="col-md-4">
                        <label for="ALOTcnseGstno" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Gstn no.
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          formControlName="ALOTcnseGstno"
                          id="ALOTcnseGstno"
                          name="ALOTcnseGstno"
                          placeholder="Enter Gstn no."
                          [value]="selectedCgneGSTN"
                          (blur)="onInputChange('ALOTcnseGstno')"
                          [ngClass]="formValidator.getValidationClass(form, 'ALOTcnseGstno')"
                          readonly
                        />
                      </div>

                      <!-- Pick-Up Point -->

                      <div class="col-md-4 position-relative">
                        <!-- Add position-relative here -->
                        <label for="ALOTcnseDlvr" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Deliver
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          (focus)="showConsigneepickupDropdown = true"
                          (focusin)="clearConsigneepickupDropdownTimeout()"
                          [(ngModel)]="selectedConsigneeDlvr"
                          formControlName="ALOTcnseDlvr"
                          id="ALOTcnseDlvr"
                          name="ALOTcnseDlvr"
                          placeholder="Deliver Point"
                          (blur)="onInputChange('ALOTcnseDlvr'); hideConsigneepickupDropdownWithDelay()"
                          (input)="
                            onInputChange('ALOTcnseDlvr'); filterConsigneePickupFromEvent($event); Datevalidation.onAlphaOnly($event)
                          "
                          [ngClass]="form.get('ALOTcnseDlvr')?.enabled ? formValidator.getValidationClass(form, 'ALOTcnseDlvr') : ''"
                        />

                        <ul
                          *ngIf="showConsigneepickupDropdown && filteredConsigneePickList.length"
                          class="dropdown-menu show shadow-sm border mt-1 rounded-3"
                          style="position: absolute; width: 100%; z-index: 1000; max-height: 220px; overflow-y: auto"
                        >
                          <!-- Force 100% width -->

                          <!-- Header -->
                          <li
                            class="dropdown-header px-3 py-2 bg-success text-black d-flex justify-content-between rainbow-label small rounded-top"
                          >
                            <span class="w-90 text-start">Pickup</span>
                            <span class="w-10 text-end">Distance</span>
                          </li>

                          <!-- Filtered Options -->
                          <li
                            *ngFor="let item of filteredConsigneePickList"
                            class="dropdown-item small px-3 py-2"
                            style="cursor: pointer"
                            (mousedown)="selectConsigneepickup(item)"
                          >
                            <div class="d-flex justify-content-between" style="font-size: 0.75rem">
                              <span class="w-90 text-start">{{ item.p_PickDlvrName }}</span>
                              <span class="w-10 text-end">{{ item.p_PickDlvrDist }}</span>
                            </div>
                          </li>
                        </ul>
                      </div>

                      <!-- Distance -->

                      <div class="col-md-4">
                        <label for="ALOTcnseDist" class="form-label rainbow-label" style="color: #383a3a">
                          <i class="bi bi-pin-map-fill text-primary me-1"></i>
                          Distance
                        </label>
                        <input
                          type="text"
                          class="form-control border border-light input-xs rounded-3 shadow-sm"
                          formControlName="ALOTcnseDist"
                          (input)="Datevalidation.onNumericOnly($event)"
                          id="ALOTcnseDist"
                          name="ALOTcnseDist"
                          placeholder="Distance"
                          (blur)="onInputChange('ALOTcnseDist')"
                          (input)="onInputChange('ALOTcnseDist')"
                          [ngClass]="form.get('ALOTcnseDist')?.enabled ? formValidator.getValidationClass(form, 'ALOTcnseDist') : ''"
                        />
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>

              <!--table grid -->

              <!-- Angular Modal (no Bootstrap JS) -->
              <div
                class="modal fade show d-block"
                tabindex="-1"
                *ngIf="isContainerModalOpen"
                style="background-color: rgba(0, 0, 0, 0.5); z-index: 1050"
              >
                <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                  <div class="modal-content border-0 shadow-lg rounded-4">
                    <!-- Modal Header -->
                    <div class="modal-header bg-primary text-white">
                      <h5 class="modal-title">Container & Payment Details</h5>
                      <button type="button" class="btn-close btn-close-white" (click)="closeContainerModal()"></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body">
                      <div class="row mt-2">
                        <div class="col-12">
                          <fieldset class="border rounded-4 shadow-sm bg-light px-3 py-2">
                            <legend class="float-none w-auto px-3 fs-6">
                              <label for="ALOTPaidby" class="rainbow-label">
                                <i class="bi bi-sliders2 me-1"></i>
                                No of containers
                                <span class="text-danger">*</span>
                              </label>
                            </legend>

                            <!-- Table with scrollable content -->
                            <div class="table-responsive">
                              <div #scrollContainer class="table-responsive" style="max-height: 120px; overflow-y: auto">
                                <table class="table table-sm table-hover align-middle table-bordered mb-0">
                                  <thead class="table-light text-center sticky-top bg-white" style="z-index: 10">
                                    <tr>
                                      <th>S.no</th>
                                      <th>Type</th>
                                      <th>Size</th>
                                      <th>No.</th>
                                      <th *ngIf="isOwnedChecked">Owner</th>
                                      <th class="text-center">Action</th>
                                    </tr>
                                  </thead>
                                  <tbody formArrayName="ALOTcontainerArray">
                                    <tr *ngFor="let container of containerArray.controls; let i = index" [formGroupName]="i">
                                      <td class="text-center small text-muted">{{ i + 1 }}</td>
                                      <td>
                                        <input
                                          formControlName="ALOTctnrType"
                                          type="text"
                                          class="form-control form-control-sm"
                                          placeholder="Type"
                                          #typeInput
                                          (focus)="showHelp(i, typeInput)"
                                          (blur)="onContainerChange()"
                                          (input)="filterContainerType(i)"
                                          (click)="filterContainerType(i)"
                                        />
                                      </td>
                                      <td>
                                        <input
                                          formControlName="ALOTctnrSize"
                                          type="text"
                                          class="form-control form-control-sm"
                                          placeholder="Size"
                                        />
                                      </td>
                                      <td>
                                        <input
                                          formControlName="ALOTctnrNo"
                                          type="text"
                                          class="form-control form-control-sm"
                                          placeholder="No."
                                          (blur)="checkContainerRowCompletion(i)"
                                        />
                                      </td>
                                      <td *ngIf="isOwnedChecked">
                                        <select formControlName="ALOTctnrOwnd" class="form-select form-select-sm">
                                          <option value="" disabled selected>Select Ownership</option>
                                          <option value="CUST">CUST</option>
                                          <option value="CONC">CONC</option>
                                        </select>
                                      </td>
                                      <td class="text-center">
                                        <div class="d-flex gap-2">
                                          <button
                                            class="btn btn-outline-danger btn-sm"
                                            type="button"
                                            (click)="removeRow(i)"
                                            [disabled]="containerArray.length === 1"
                                          >
                                            <i class="bi bi-trash3">-</i>
                                          </button>
                                          <button
                                            *ngIf="i === containerArray.length - 1"
                                            class="btn btn-outline-success btn-sm"
                                            type="button"
                                            [disabled]="!containerArray.at(i).valid"
                                            (click)="addRow()"
                                          >
                                            <i class="bi bi-plus-circle">+</i>
                                          </button>
                                        </div>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                            <div *ngIf="form.get('ALOTcontainerArray')?.errors?.duplicateContainerOwnership" class="text-danger small mt-2">
                              🚫 Duplicate container types with the same ownership are not allowed.
                            </div>

                            <!-- Help Dropdown OUTSIDE table -->
                            <!-- Floating Dropdown -->
                            <ul
                              *ngIf="helpDropdownIndex !== null && filteredContainerTypes.length"
                              class="dropdown-menu show shadow-sm border rounded-3"
                              [ngStyle]="{
                                position: 'fixed',
                                top: helpDropdownTop + 'px',
                                left: helpDropdownLeft + 'px',
                                zIndex: 9999,
                                maxHeight: '150px',
                                overflowY: 'auto',
                                width: '240px',
                                backgroundColor: 'white'
                              }"
                            >
                              <li
                                class="dropdown-header px-3 py-2 bg-success text-black d-flex justify-content-between rainbow-label small rounded-top"
                              >
                                <span>Type</span>
                                <span>Size</span>
                              </li>
                              <li
                                *ngFor="let item of filteredContainerTypes"
                                class="dropdown-item small d-flex justify-content-between align-items-center"
                                (click)="selectContainerType(item, helpDropdownIndex!)"
                              >
                                <b>{{ item.p_CntrType }}</b>
                                <span class="text-muted">{{ item.p_CntrSize }}</span>
                              </li>
                            </ul>
                          </fieldset>
                        </div>
                      </div>
                      <div class="d-flex justify-content-end mt-3">
                        <div style="text-align: right; margin-top: 1rem">
                          <button class="btn-modern submit-btn" type="submit">
                            <i class="bi bi-check-circle-fill me-2"></i>
                            Calculate Indent Charges
                          </button>
                        </div>
                      </div>

                      <!-- Second Row: Payment Details -->
                      <div class="row mt-3">
                        <div class="col-12">
                          <div class="">
                            <fieldset class="border rounded-4 shadow-sm bg-light px-3 pt-1 pb-3">
                              <legend class="float-none w-auto px-3 fs-6">
                                <label for="ALOTPaidby" class="rainbow-label">
                                  <i class="bi bi-sliders2 me-1"></i>
                                  Payment Details
                                  <span class="text-danger">*</span>
                                </label>
                              </legend>

                              <div class="row g-3">
                                <div class="col-md-3">
                                  <label for="ALOTPaidby" class="form-label rainbow-label">
                                    <i class="bi bi-pin-map-fill text-primary me-1"></i>
                                    Paid By
                                    <span class="text-danger">*</span>
                                  </label>

                                  <div class="d-flex align-items-center gap-4 p-2">
                                    <!-- CNSR Option -->
                                    <!-- <label class="custom-radio">
      <input type="radio" formControlName="ALOTPaidby" name="ALOTPaidby" id="ALOTpbCNSR" value="C" >
      <span class="radio-btn"></span>
      <span class="label-text">CNSR</span>
    </label> -->
                                    <label class="custom-radio">
                                      <input type="radio" formControlName="ALOTPaidby" name="ALOTPaidby" id="ALOTpbCNSR" value="C" />
                                      <span class="radio-btn"></span>
                                      <span class="label-text">CNSR</span>
                                    </label>
                                  </div>
                                </div>

                                <div class="col-md-3">
                                  <label for="ALOTtype" class="form-label rainbow-label">
                                    <i class="bi bi-pin-map-fill text-primary me-1"></i>
                                    Payment Type
                                    <span class="text-danger">*</span>
                                  </label>

                                  <div class="d-flex align-items-center gap-4 p-2">
                                    <!-- CA Option -->
                                    <label class="custom-radio">
                                      <input
                                        type="radio"
                                        formControlName="ALOTtype"
                                        name="ALOTtype"
                                        id="ALOTtypeCA"
                                        value="N"
                                        (click)="onConsignerOrConsigneeRadioClick()"
                                        [disabled]="!isRadioEnabled"
                                      />
                                      <span class="radio-btn"></span>
                                      <span class="label-text">CA</span>
                                    </label>

                                    <!-- PDA Option -->
                                    <label class="custom-radio">
                                      <input
                                        type="radio"
                                        formControlName="ALOTtype"
                                        name="ALOTtype"
                                        id="ALOTtypePDA"
                                        value="P"
                                        (click)="onConsignerOrConsigneeRadioClick()"
                                        [disabled]="!isRadioEnabled"
                                      />
                                      <span class="radio-btn"></span>
                                      <span class="label-text">PDA</span>
                                    </label>
                                  </div>
                                </div>

                                <div class="col-md-2">
                                  <label for="ALOTamount" class="form-label rainbow-label">
                                    <i class="bi bi-pin-map-fill text-primary me-1"></i>
                                    CPDA Code
                                  </label>
                                  <input
                                    type="text"
                                    class="form-control border border-light input-xs rounded-3 shadow-sm bg-light"
                                    formControlName=""
                                    id="ALOTamount"
                                    name="ALOTamount"
                                    placeholder="CP01"
                                    readonly
                                  />
                                </div>

                                <div class="col-md-2">
                                  <label for="ALOTamount" class="form-label rainbow-label">
                                    <i class="bi bi-pin-map-fill text-primary me-1"></i>
                                    Balance
                                  </label>
                                  <input
                                    type="text"
                                    class="form-control border border-light input-xs rounded-3 shadow-sm bg-light"
                                    formControlName=""
                                    id="ALOTamount"
                                    name="ALOTamount"
                                    placeholder="9000000"
                                    readonly
                                  />
                                </div>

                                <!-- Amount & Receipt Section -->
                                <div class="col-md-2">
                                  <label for="ALOTamount" class="form-label rainbow-label">
                                    <i class="bi bi-pin-map-fill text-primary me-1"></i>
                                    Amount
                                  </label>
                                  <input
                                    type="text"
                                    class="form-control border border-light input-xs rounded-3 shadow-sm bg-light"
                                    formControlName="ALOTamount"
                                    id="ALOTamount"
                                    name="ALOTamount"
                                    placeholder="0"
                                    readonly
                                  />
                                </div>
                              </div>
                            </fieldset>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="modal-footer">
                      <button class="btn-modern submit-btn" type="submit">
                        <i class="bi bi-check-circle-fill me-2"></i>
                        Submit
                      </button>
                      <button class="btn btn-outline-secondary" (click)="closeContainerModal()">❌ Cancel</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row mt-3">
                <div class="button-wrapper">
                  <button class="btn btn-outline-primary custom-btn" type="button" (click)="openContainerModal()">
                    <i class="bi bi-box-fill me-2 text-primary"></i>
                    Add Container & Payment Info
                  </button>

                  <button class="btn-modern reset-btn">
                    <i class="bi bi-arrow-counterclockwise me-2"></i>
                    Reset
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- </fieldset> -->
        </div>
      </div>
    </div>
  </div>

  <!-- submit grid end -->
</form>

<app-loader [isLoading]="isLoading"></app-loader>
