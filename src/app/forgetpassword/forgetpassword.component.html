<div class="row align-items-center text-center">
  <div class="col-md-12">
    <div class="card-body">

      <h4 class="login-title text-center mb-4">
        <i class="bi bi-shield-lock me-2"></i> Reset Your Password
      </h4>

      <!-- Step 1 -->
      <!-- Step 1 -->
<form [formGroup]="form" *ngIf="step === 1">
  <!-- Username -->
  <div class="input-group mb-3">
    <span class="input-group-text"><i class="feather icon-user"></i></span>
    <input type="text" formControlName="username" class="form-control" placeholder="Enter Username" />
  </div>

  <!-- Mobile -->
  <div class="input-group mb-3">
    <span class="input-group-text"><i class="feather icon-phone"></i></span>
    <input type="text" formControlName="mobile" class="form-control" placeholder="Registered Mobile No." />
  </div>

  <!-- Email -->
  <div class="input-group mb-3">
    <span class="input-group-text"><i class="feather icon-mail"></i></span>
    <input type="email" formControlName="email" class="form-control" placeholder="Registered Email Address" />
  </div>

  <!-- Captcha -->
  <div class="input-group mb-3" *ngIf="!captchaVerified">
    <app-captcha></app-captcha>
  </div>

  <!-- OTP for Mobile -->
  <div *ngIf="captchaVerified && !mobileOtpVerified" class="mb-3">
    <label class="form-label small text-muted d-block mb-2">
      Enter Mobile OTP sent to <strong>{{ form.value.mobile ? '+91-******' + (form.value.mobile | slice: -4) : '' }}</strong>
    </label>
    <div class="d-flex justify-content-center gap-2 mb-2" formArrayName="mobileOtp">
      <input *ngFor="let ctrl of mobileOtpControls; let i = index"
             type="text"
             inputmode="numeric"
             maxlength="1"
             class="form-control text-center otp-box"
             style="width: 35px; height: 35px; font-size: 16px; padding: 0;"
             [formControl]="mobileOtpControls[i]"
             (input)="onMobileOtpInput($event, i)"
             (keydown.backspace)="onMobileOtpBackspace($event, i)"
             (paste)="onMobileOtpPaste($event)" />
    </div>
    <button class="btn btn-success btn-sm w-100"
            type="button"
            [disabled]="mobileOtpArray.value.join('').length !== 6 || mobileOtpStatus === 'expired'"
            (click)="verifyMobileOtp()">Verify Mobile OTP</button>
  </div>

  <!-- OTP for Email -->
  <div *ngIf="captchaVerified && !emailOtpVerified" class="mb-3">
    <label class="form-label small text-muted d-block mb-2">
      Enter Email OTP sent to <strong>{{ form.value.email }}</strong>
    </label>
    <div class="d-flex justify-content-center gap-2 mb-2" formArrayName="emailOtp">
      <input *ngFor="let ctrl of emailOtpControls; let i = index"
             type="text"
             inputmode="numeric"
             maxlength="1"
             class="form-control text-center otp-box"
             style="width: 35px; height: 35px; font-size: 16px; padding: 0;"
             [formControl]="emailOtpControls[i]"
             (input)="onEmailOtpInput($event, i)"
             (keydown.backspace)="onEmailOtpBackspace($event, i)"
             (paste)="onEmailOtpPaste($event)" />
    </div>
    <button class="btn btn-success btn-sm w-100"
            type="button"
            [disabled]="emailOtpArray.value.join('').length !== 6 || emailOtpStatus === 'expired'"
            (click)="verifyEmailOtp()">Verify Email OTP</button>
  </div>

  <!-- Captcha Submit Button -->
  <div class="d-grid" *ngIf="!captchaVerified">
    <button class="btn btn-primary" type="button" (click)="verifyCaptcha()">Submit</button>
  </div>
</form>


      <!-- Step 2: Password -->
      <form [formGroup]="form" *ngIf="step === 2">
        <!-- New Password -->
        <div class="input-group mb-3">
          <span class="input-group-text"><i class="feather icon-lock"></i></span>
          <input type="password" formControlName="newPassword" class="form-control" placeholder="New Password" />
        </div>

        <!-- Confirm Password -->
        <div class="input-group mb-3">
          <span class="input-group-text"><i class="feather icon-lock"></i></span>
          <input type="password" formControlName="confirmPassword" class="form-control" placeholder="Confirm Password" />
        </div>

        <div class="d-grid">
          <button class="btn btn-primary" type="button" (click)="savePassword()">Save Password</button>
        </div>
      </form>

      <!-- Links -->
      <p class="mt-3 text-muted">
        Back to <a (click)="switchToLogin()" class="f-w-400">Login</a>
      </p>
    </div>
  </div>
</div>
